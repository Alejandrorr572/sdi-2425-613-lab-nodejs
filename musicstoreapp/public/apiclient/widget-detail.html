<div id="widget-detalles">
  <div class="form-group">
    <label class="control-label col-sm-2" for="title">Nombre:</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" name="title"
             placeholder="Título de la canción" id="title"/>
      <span class="text-danger" id="error-title"></span>
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2" for="kind">Género:</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" name="kind"
             placeholder="Género de la canción" id="kind"/>
      <span class="text-danger" id="error-kind"></span>
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2" for="price">Precio (€):</label>
    <div class="col-sm-10">
      <input type="number" step="0.01" class="form-control" name="price"
             placeholder="2.50" id="price"/>
      <span class="text-danger" id="error-price"></span>
    </div>
  </div>

  <div id="error-message" class="text-danger"></div>

  <button class="btn btn-success" onclick="updateSong()">Guardar cambios</button>
  <button class="btn btn-secondary" onclick="widgetSongs()">Volver</button>
</div>

<script>

  function loadSongDetails() {
    $.ajax({
      url: URLbase + "/songs/" + selectedSongId,
      type: "GET",
      dataType: 'json',
      headers: { "token": token },
      success: function (response) {
        if (response && response.song) {
          $("#title").val(response.song.title);
          $("#kind").val(response.song.kind);
          $("#price").val(response.song.price);
        } else {
          $("#error-message").text("Error: No se encontraron detalles de la canción.");
        }
      },
      error: function () {
        $("#error-message").text("Error al cargar los detalles de la canción.");
      }
    });
  }

  function updateSong() {
    let title = $("#title").val().trim();
    let kind = $("#kind").val().trim();
    let price = parseFloat($("#price").val());

    let isValid = true;
    $(".text-danger").text("");

    if (!title || title.length < 3) {
      $("#error-title").text("El título debe tener al menos 3 caracteres.");
      isValid = false;
    }

    if (!kind || kind.length < 3) {
      $("#error-kind").text("El género debe tener al menos 3 caracteres.");
      isValid = false;
    }

    if (isNaN(price) || price <= 0) {
      $("#error-price").text("El precio debe ser un número positivo.");
      isValid = false;
    }

    if (!isValid) {
      $("#error-message").text("Corrige los errores antes de guardar.");
      return;
    }

    $.ajax({
      url: URLbase + "/songs/" + selectedSongId,
      type: "PUT",
      dataType: 'json',
      contentType: "application/json",
      headers: { "token": token },
      data: JSON.stringify({ title, kind, price }),
      success: function () {
        widgetSongs();
      },
      error: function (error) {
        console.log(error);
        $("#error-message").text("Error al actualizar la canción.");
      }
    });
  }

  function widgetSongs() {
    $("#main-container").load("widget-songs.html");
  }

  $(document).ready(loadSongDetails);
</script>
